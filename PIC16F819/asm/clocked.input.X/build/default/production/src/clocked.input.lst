MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ; --- Test for clock speed and instruction ops
                      00002 
                      00003 
                      00004 ; Main entry point
                      00005 
                      00006         list    P=PIC16F819
                      00007 
                      00008 #include p16f819.inc
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F819 processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2011 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00442         LIST
                      00009 
                      00010 ; ------------------------------------------------------------------------------
                      00011 ; CONFIG
                      00012 ;       - Use internal oscillator, leaing all PORTB ports as I/O
                      00013 ;       - Disable watchdog timer
                      00014 ;
                      00015         ;__config       _INTRC_IO & _WDT_OFF
2007   3FEA           00016         __config        _HS_OSC & _WDT_OFF      ; External Crystal Oscillator - produces slightly more t
                            han two transistions per second
                      00017                                                 ; Was able to sucessfully run the chip with only the Xta
                            l directly connected to the
                      00018                                                 ; OSC1/OSC0 pins, no resistor, no capacitors!
                      00019 
                      00020         cblock  0x20            ; start addresses in user register space
  00000020            00021         W_TMP
  00000021            00022         ST_TMP
  00000022            00023         CNT1
  00000023            00024         CNT2
  00000024            00025         CNT3
  00000025            00026         CURVAL
  00000026            00027         SAMPDONE
                      00028         endc
                      00029 
                      00030 
                      00031 ; ------------------------------------------------------------------------------
                      00032 ; Main entry and RESET vector
                      00033 ;
                      00034         org     0x0000
0000   2???           00035         call    _SETUP          ; Init hardware
0001   2???           00036         goto    _MAIN           ; Jump to main code defined in Example.asm
                      00037 
                      00038 
                      00039 ; ------------------------------------------------------------------------------
                      00040 ; Interrupt vector
                      00041 ;
                      00042         org     0x0004
MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0004   2???           00043         goto    _SERVICE        ; Points to interrupt service routine
                      00044 
                      00045 
                      00046 ; ------------------------------------------------------------------------------
                      00047 ; Dispatcher for interrupt handlers
                      00048 ;
0005                  00049 _SERVICE:
0005   1283 1303      00050         banksel PORTA
0007   2???           00051         call    _SAVE_CONTEXT
                      00052 
                      00053         ; Assumes only one interrupt will be enabled at a time
0008                  00054 _CHECK_TMR0:
                      00055         ;btfsc  INTCON,TMR0IF   ; Check for Timer0 interrupt
                      00056         ;goto   _HANDLE_TMR0
0008                  00057 _CHECK_INT:
0008   188B           00058         btfsc   INTCON,INTF     ; Check for INT/RB0 interrupt
0009   2???           00059         goto    _HANDLE_INT
000A                  00060 _CHECK_ADI:
000A   1B0C           00061         btfsc   PIR1,ADIF
000B   2???           00062         goto    _HANDLE_ADI
                      00063 
000C                  00064 _UNHANDLED:
                      00065 
000C                  00066 _EXIT_SERVICE:
                      00067         ;bcf    INTCON,TMR0IF   ; clear the TMR0 interrupt
000C   2???           00068         call    _RESTORE_CONTEXT
000D   0009           00069         retfie                  ; Service return
                      00070 
                      00071 
000E                  00072 _HANDLE_INT:
000E   1283 1303      00073         banksel CURVAL
0010   0BA5           00074         decfsz  CURVAL,F
0011   2???           00075         goto    _EXIT_SERVICE
                      00076         ; Reset to 64
0012   3040           00077         movlw   0x40
0013   00A5           00078         movwf   CURVAL
0014   108B           00079         bcf     INTCON,INTF     ; clear the INT interrupt
0015   2???           00080         goto    _EXIT_SERVICE
                      00081 
0016                  00082 _HANDLE_ADI:    ; !! Haven't been able to get the AD interrupt to fire, direct polling of the GO/DONE bi
                            t works tho, so ADC is working
0016   1283 1303      00083         banksel ADRESH          ; Copy current AD conversion to CURVAL
0018   081E           00084         movfw   ADRESH
                      00085 
0019   1283 1303      00086         banksel CURVAL
001B   00A5           00087         movwf   CURVAL
001C   130C           00088         bcf     PIR1,ADIF       ; clear ADI
001D   2???           00089         goto    _EXIT_SERVICE
                      00090 
                      00091 ; ------------------------------------------------------------------------------
                      00092 ; Context SAVE/RESTORE routines
                      00093 ;
001E                  00094 _SAVE_CONTEXT:
MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

001E   00A0           00095         movwf   W_TMP           ;Copy W to TEMP register
001F   0E03           00096         swapf   STATUS, W       ;Swap status to be saved into W
0020   0183           00097         clrf    STATUS          ;bank 0, regardless of current bank, Clears IRP,RP1,RP0
0021   00A1           00098         movwf   ST_TMP          ;Save status to bank zero STATUS_TEMP register
0022   0008           00099         return
                      00100 
0023                  00101 _RESTORE_CONTEXT:
0023   0E21           00102         SWAPF ST_TMP, W         ;Swap STATUS_TEMP register into W
                      00103                                 ;(sets bank to original state)
0024   0083           00104         MOVWF STATUS            ;Move W into STATUS register
0025   0EA0           00105         SWAPF W_TMP, F          ;Swap W_TEMP
0026   0E20           00106         SWAPF W_TMP, W          ;Swap W_TEMP into W
0027   0008           00107         return
                      00108 
                      00109 
                      00110 ; ------------------------------------------------------------------------------
                      00111 ; Initialize hardware
                      00112 ;
0028                  00113 _SETUP:
                      00114 ; Init clock to 8Mhz => 111
                      00115         ;banksel OSCCON         ; Bank 1, used for all other setup calls
                      00116         ;bsf    OSCCON, IRCF0
                      00117         ;bsf    OSCCON, IRCF1
                      00118         ;bsf    OSCCON, IRCF2
                      00119 
                      00120 ; Init I/O ports
0028   1683 1303      00121         banksel ADCON1
002A   3000           00122         movlw   0x00            ; 0:4 Analog
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002B   009F           00123         movwf   ADCON1
                      00124 
002C   1683 1303      00125         banksel TRISA
002E   30FF           00126         movlw   0xFF            ; PORTA - All input
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002F   0085           00127         movwf   TRISA
                      00128 
0030   1683 1303      00129         banksel TRISB
0032   3001           00130         movlw   0x01            ; PORTB - Input only on RB0
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0033   0086           00131         movwf   TRISB
                      00132 
                      00133 ; Configure interrupts
0034   1683 1303      00134         banksel PIE1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0036   170C           00135         bsf     PIE1,ADIE       ; Enale ad conversion interrupt
0037   1283 1303      00136         banksel INTCON
0039   120B           00137         bcf     INTCON,INTE     ; DIS-Enable external int on RB0
003A   170B           00138         bsf     INTCON,PEIE     ; Enable periferial interrups for ADI
003B   178B           00139         bsf     INTCON,GIE      ; Enable interrupts globally
                      00140 
003C   130C           00141         bcf     PIR1,ADIF       ; clear ADI
                      00142 
                      00143 ; Configure External interrupt
MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

003D   1683 1303      00144         banksel OPTION_REG
003F   30C0           00145         movlw   0xC0            ; Rising edge
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0040   0081           00146         movwf   OPTION_REG
                      00147 
                      00148 ; Init and Clear PORTA and PORTB
0041   1283 1303      00149         banksel PORTA
0043   0185           00150         clrf    PORTA
0044   0186           00151         clrf    PORTB
                      00152 
0045   1283 1303      00153         banksel CNT1
0047   01A2           00154         clrf    CNT1
0048   01A3           00155         clrf    CNT2
0049   01A4           00156         clrf    CNT3
                      00157 
                      00158         ; Init to 64 steps
004A   3040           00159         movlw   0x40
004B   00A5           00160         movwf   CURVAL
                      00161 
004C   01A5           00162         clrf    CURVAL
004D   01A6           00163         clrf    SAMPDONE
004E   1426           00164         bsf     SAMPDONE,0      ; Trigger sampling on start
                      00165 
                      00166 
                      00167 
                      00168 ;Setup AD Conversion on A0 for now
004F   1283 1303      00169         banksel ADCON0
0051   3081           00170         movlw   0x81    ; AD Enabled on A0, 32Tosc clock
0052   009F           00171         movwf   ADCON0
                      00172 
0053   1683 1303      00173         banksel ADCON1
0055   3000           00174         movlw   0x00    ; left justify since we're only going to read ADRESH for now
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0056   009F           00175         movwf   ADCON1
                      00176 
0057   0008           00177         return
                      00178 
                      00179 ; -------
                      00180 ; Subs
                      00181 ;
                      00182 
0058                  00183 _RB4_CLR:
0058   1206           00184         bcf     PORTB,4
                      00185         ;goto   _INIT_CNT1
0059   2???           00186         goto    _UPDATE_RB4
                      00187 
005A                  00188 _START_SAMPLE:
005A   1283 1303      00189         banksel ADCON0
005C   151F           00190         bsf     ADCON0,2        ; Start Sampling
                      00191                         ; End will be handled by interrupt
005D   1283 1303      00192         banksel SAMPDONE
005F   01A6           00193         clrf    SAMPDONE
0060   2???           00194         goto    _INIT_CNT1
MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00195 
                      00196 
                      00197 ; ------------------------------------------------------------------------------
                      00198 ; Main code loop
                      00199 ;
                      00200 ; RB4 drives LED
                      00201 ; RB0 clock input
                      00202 ;
                      00203 
0061                  00204 _MAIN:
                      00205 
                      00206 
0061                  00207 _LOOP:
                      00208 
0061                  00209 _UPDATE_RB4:
0061   0000           00210         nop
                      00211         ;btfss  CURVAL,0
                      00212         ;goto   _RB4_CLR
                      00213         ;bsf    PORTB,4
                      00214 
0062   1283 1303      00215         banksel CURVAL
0064   0825           00216         movfw   CURVAL          ; Push CURVAL to PORTB
0065   1283 1303      00217         banksel PORTB
0067   0086           00218         movwf   PORTB
                      00219 
                      00220         ;goto _UPDATE_RB4
                      00221 
                      00222         ;banksel        PORTB           ; Toggle RB4
                      00223         ;btfsc  PORTB,4
                      00224         ;goto   _RB4_CLR
                      00225         ;bsf    PORTB,4
                      00226 
0068                  00227 _CHECK_SAMPLE:
0068   1826           00228         btfsc   SAMPDONE,0
0069   2???           00229         goto    _START_SAMPLE
006A   191F           00230         btfsc   ADCON0,2
006B   2???           00231         goto    _INIT_CNT1
006C   1426           00232         bsf     SAMPDONE,0      ; Signal that sampling is done so that next loop we can restart sampling
                      00233 
                      00234         ;banksel ADRESH         ; Copy current AD conversion to CURVAL
                      00235         ;movfw  ADRESH
                      00236 
                      00237         ;banksel        CURVAL
                      00238         ;movlw  0xff
                      00239         ;movwf  CURVAL
                      00240 
                      00241 
006D                  00242 _INIT_CNT1:
006D   1283 1303      00243         banksel CNT1            
006F   30FF           00244         movlw   0xFF            ; Load counter
0070   00A2           00245         movwf   CNT1
                      00246         
0071                  00247 _CNT1:  
MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0071   0BA2           00248         decfsz  CNT1,F
0072   2???           00249         goto    _INIT_CNT2
0073   2???           00250         goto    _END
                      00251 
0074                  00252 _INIT_CNT2:
0074   1283 1303      00253         banksel CNT2
0076   30FF           00254         movlw   0xFF            ; Load counter
0077   00A3           00255         movwf   CNT2
                      00256 
0078                  00257 _CNT2:
0078   0BA3           00258         decfsz  CNT2,F
0079   2???           00259         goto    _INIT_CNT3
007A   2???           00260         goto    _CNT1
                      00261 
007B                  00262 _INIT_CNT3:
007B   1283 1303      00263         banksel CNT3
007D   300F           00264         movlw   0x0F            ; Load counter
007E   00A4           00265         movwf   CNT3
                      00266 
007F                  00267 _CNT3:
007F   0BA4           00268         decfsz  CNT3,F
0080   2???           00269         goto    _CNT3
0081   2???           00270         goto    _CNT2
                      00271 
0082                  00272 _END:
                      00273         ;bcf    PORTB,4
0082   2???           00274         goto    _LOOP
                      00275 
0083                  00276 _ENDLESSLOOP:
0083   0000           00277         nop
0084   2???           00278         goto    _ENDLESSLOOP
3FEA                  00279         end
MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE  7


SYMBOL TABLE
  LABEL                             VALUE 

ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADCS2                             00000006
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
BF                                00000000
C                                 00000000
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CKE                               00000006
CKP                               00000004
CNT1                              00000022
CNT2                              00000023
CNT3                              00000024
CURVAL                            00000025
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
D_A                               00000005
D_NOT_A                           00000005
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
F                                 00000001
FREE                              00000004
FSR                               00000004
GIE                               00000007
GO                                00000002
MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE  8


SYMBOL TABLE
  LABEL                             VALUE 

GO_DONE                           00000002
GO_NOT_DONE                       00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IOFS                              00000002
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_W                             00000002
NOT_WRITE                         00000002
OPTION_REG                        00000081
OSCCON                            0000008F
OSCTUNE                           00000090
P                                 00000004
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
R                                 00000002
RA0                               00000000
MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE  9


SYMBOL TABLE
  LABEL                             VALUE 

RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RD                                00000000
READ_WRITE                        00000002
RP0                               00000005
RP1                               00000006
R_NOT_W                           00000002
R_W                               00000002
S                                 00000003
SAMPDONE                          00000026
SMP                               00000007
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
ST_TMP                            00000021
T0CS                              00000005
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE 10


SYMBOL TABLE
  LABEL                             VALUE 

TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISA6                            00000006
TRISA7                            00000007
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TUN5                              00000005
UA                                00000001
W                                 00000000
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
W_TMP                             00000020
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_BOREN_OFF                        00003FBF
_BOREN_ON                         00003FFF
_CCP1_RB2                         00003FFF
_CCP1_RB3                         00002FFF
_CCPMX_RB2                        00003FFF
MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE 11


SYMBOL TABLE
  LABEL                             VALUE 

_CCPMX_RB3                        00002FFF
_CHECK_ADI                        0000000A
_CHECK_INT                        00000008
_CHECK_SAMPLE                     00000068
_CHECK_TMR0                       00000008
_CNT1                             00000071
_CNT2                             00000078
_CNT3                             0000007F
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00001FFF
_CP_OFF                           00003FFF
_CP_ON                            00001FFF
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_DEVID1                           00002006
_END                              00000082
_ENDLESSLOOP                      00000083
_EXIT_SERVICE                     0000000C
_EXTCLK                           00003FEF
_EXTRC_CLKOUT                     00003FFF
_EXTRC_IO                         00003FFE
_FOSC_EC                          00003FEF
_FOSC_EXTRCCLK                    00003FFF
_FOSC_EXTRCIO                     00003FFE
_FOSC_HS                          00003FEE
_FOSC_INTOSCCLK                   00003FFD
_FOSC_INTOSCIO                    00003FFC
_FOSC_LP                          00003FEC
_FOSC_XT                          00003FED
_HANDLE_ADI                       00000016
_HANDLE_INT                       0000000E
_HS_OSC                           00003FEE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_INIT_CNT1                        0000006D
_INIT_CNT2                        00000074
_INIT_CNT3                        0000007B
_INTRC_CLKOUT                     00003FFD
_INTRC_IO                         00003FFC
_LOOP                             00000061
_LP_OSC                           00003FEC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_MAIN                             00000061
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_MCLR_OFF                         00003FDF
_MCLR_ON                          00003FFF
_PWRTE_OFF                        00003FFF
MPASM  5.43                 CLOCKED.INPUT.ASM   2-20-2017  15:53:59         PAGE 12


SYMBOL TABLE
  LABEL                             VALUE 

_PWRTE_ON                         00003FF7
_RB4_CLR                          00000058
_RESTORE_CONTEXT                  00000023
_SAVE_CONTEXT                     0000001E
_SERVICE                          00000005
_SETUP                            00000028
_START_SAMPLE                     0000005A
_UNHANDLED                        0000000C
_UPDATE_RB4                       00000061
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_1024                         00003BFF
_WRT_1536                         000039FF
_WRT_512                          00003DFF
_WRT_ENABLE_1024                  00003BFF
_WRT_ENABLE_1536                  000039FF
_WRT_ENABLE_512                   00003DFF
_WRT_ENABLE_OFF                   00003FFF
_WRT_OFF                          00003FFF
_XT_OSC                           00003FED
__16F819                          00000001

Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     6 reported,     0 suppressed

